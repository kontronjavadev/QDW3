<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="jakarta.faces.facelets"
	xmlns:h="jakarta.faces.html"
	xmlns:f="jakarta.faces.core"
	xmlns:p="http://primefaces.org/ui"
	template="/templates/ui.xhtml">

<f:metadata>
	<f:viewAction action="#{userView.initView()}"/>
</f:metadata>

<ui:define name="title">#{userView.formTitle}</ui:define>

<ui:define name="content">
	<h:panelGrid columns="3">
		<div class="pi pi-list" style="font-size: 2em"/>
		<h:outputText id="lblFormTitle" value="&#160;#{userView.formTitle}" styleClass="label-form-title"/>
		<p:ajaxStatus style="width:16px;height:16px;">
			<f:facet name="start">
				<h:graphicImage value="/images/ajaxloading.gif"/>
			</f:facet>

			<f:facet name="complete">
				<h:outputText value=""/>
			</f:facet>
		</p:ajaxStatus>
	</h:panelGrid>

	<p:growl id="growl" showDetail="true" skipDetailIfEqualsSummary="true"/>

	<p:dialog height="auto" width="1000" header="#{i18n.search_input_dlg}" widgetVar="dlgSearchInput" id="dlgSearchInput" modal="true" closeOnEscape="true">
		<p:tabView id="tabViewSearchInput" dynamic="false">
			<p:tab title="#{i18n.search_input_filter}">
			<p:scrollPanel style="width:100%; #{sizeServiceBean.searchFilterHeight()};" mode="native">
			<h:panelGrid columns="5" cellpadding="3">
				<h:outputText styleClass="label-field-mandatory" value="#{i18n.search_input_column}"/>
				<h:outputText styleClass="label-field-mandatory" value="#{i18n.search_input_operator}"/>
				<h:outputText styleClass="label-field-mandatory" value="#{i18n.search_input_sort}"/>
				<h:outputText styleClass="label-field-mandatory" value="#{i18n.search_input_filter_input}"/>
				<h:outputText styleClass="label-field-mandatory" value="#{i18n.search_input_and}"/>

				<h:outputLabel styleClass="label-field-optional" for="fi_0" value="#{userView.searchObject.searchFields[0].colLabel}"/>
				<p:selectOneMenu valueChangeListener="#{userView.onOperatorChanged}" style="width:150px;" styleClass="label-field-optional" id="o_0" value="#{userView.searchObject.searchFields[0].operator}" converter="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.SearchOperatorDTOConverter">
					<f:selectItems update="b_0" value="#{userView.textOperators}" var="advInputItem0" itemValue="#{advInputItem0}" itemLabel="#{advInputItem0.description}"/>
					<f:ajax render="p_0"/>
				</p:selectOneMenu>
				<p:selectOneMenu styleClass="label-field-optional" widgetVar="st_0" id="s_0" value="#{userView.searchObject.searchFields[0].sortOrder}">
					<f:selectItems value="#{userView.sortOrderList}"/>
				</p:selectOneMenu>
				<p:inputText id="fi_0" value="#{userView.searchObject.searchFields[0].stringCriterion}" size="30"/>
				<h:panelGroup id="p_0">
					<p:inputText id="b_0" rendered="#{userView.searchObject.searchFields[0].between}" value="#{userView.searchObject.searchFields[0].stringBetweenCriterion}" size="30"/>
				</h:panelGroup>

				<h:outputLabel styleClass="label-field-optional" for="fi_1" value="#{userView.searchObject.searchFields[1].colLabel}"/>
				<p:selectOneMenu valueChangeListener="#{userView.onOperatorChanged}" style="width:150px;" styleClass="label-field-optional" id="o_1" value="#{userView.searchObject.searchFields[1].operator}" converter="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.SearchOperatorDTOConverter">
					<f:selectItems update="b_1" value="#{userView.textOperators}" var="advInputItem1" itemValue="#{advInputItem1}" itemLabel="#{advInputItem1.description}"/>
					<f:ajax render="p_1"/>
				</p:selectOneMenu>
				<p:selectOneMenu styleClass="label-field-optional" widgetVar="st_1" id="s_1" value="#{userView.searchObject.searchFields[1].sortOrder}">
					<f:selectItems value="#{userView.sortOrderList}"/>
				</p:selectOneMenu>
				<p:inputText id="fi_1" value="#{userView.searchObject.searchFields[1].stringCriterion}" size="30"/>
				<h:panelGroup id="p_1">
					<p:inputText id="b_1" rendered="#{userView.searchObject.searchFields[1].between}" value="#{userView.searchObject.searchFields[1].stringBetweenCriterion}" size="30"/>
				</h:panelGroup>

				<h:outputLabel styleClass="label-field-optional" for="fc_2" value="#{userView.searchObject.searchFields[2].colLabel}"/>
				<p:selectOneMenu valueChangeListener="#{userView.onOperatorChanged}" style="width:150px;" styleClass="label-field-optional" id="o_2" value="#{userView.searchObject.searchFields[2].operator}" converter="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.SearchOperatorDTOConverter">
					<f:selectItems update="b_2" value="#{userView.boolOperators}" var="advInputItem2" itemValue="#{advInputItem2}" itemLabel="#{advInputItem2.description}"/>
					<f:ajax render="p_2"/>
				</p:selectOneMenu>
				<p:selectOneMenu styleClass="label-field-optional" widgetVar="st_2" id="s_2" value="#{userView.searchObject.searchFields[2].sortOrder}">
					<f:selectItems value="#{userView.sortOrderList}"/>
				</p:selectOneMenu>
				<p:selectOneMenu id="fc_2" value="#{userView.searchObject.searchFields[2].stringCriterion}">
					<f:selectItem itemLabel="" itemValue=""/>
					<f:selectItem itemLabel="true" itemValue="true"/>
					<f:selectItem itemLabel="false" itemValue="false"/>
				</p:selectOneMenu>
				<h:panelGroup id="p_2"/>

				<h:outputLabel styleClass="label-field-optional" for="fi_3" value="#{userView.searchObject.searchFields[3].colLabel}"/>
				<p:selectOneMenu valueChangeListener="#{userView.onOperatorChanged}" style="width:150px;" styleClass="label-field-optional" id="o_3" value="#{userView.searchObject.searchFields[3].operator}" converter="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.SearchOperatorDTOConverter">
					<f:selectItems update="b_3" value="#{userView.dateOperators}" var="advInputItem3" itemValue="#{advInputItem3}" itemLabel="#{advInputItem3.description}"/>
					<f:ajax render="p_3"/>
				</p:selectOneMenu>
				<p:selectOneMenu styleClass="label-field-optional" widgetVar="st_3" id="s_3" value="#{userView.searchObject.searchFields[3].sortOrder}">
					<f:selectItems value="#{userView.sortOrderList}"/>
				</p:selectOneMenu>
				<p:datePicker id="fi_3" value="#{userView.searchObject.searchFields[3].dateCriterion}" pattern="#{userSession.dateTimeFormat}" size="20" showButtonBar="true" showIcon="true" showTime="true"/>
				<h:panelGroup id="p_3">
					<p:datePicker id="fb_3" value="#{userView.searchObject.searchFields[3].dateBetweenCriterion}" pattern="#{userSession.dateTimeFormat}" size="20" showButtonBar="true" showIcon="true" rendered="#{userView.searchObject.searchFields[3].between}" showTime="true"/>
				</h:panelGroup>

				<h:outputLabel styleClass="label-field-optional" for="fi_4" value="#{userView.searchObject.searchFields[4].colLabel}"/>
				<p:selectOneMenu valueChangeListener="#{userView.onOperatorChanged}" style="width:150px;" styleClass="label-field-optional" id="o_4" value="#{userView.searchObject.searchFields[4].operator}" converter="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.SearchOperatorDTOConverter">
					<f:selectItems update="b_4" value="#{userView.dateOperators}" var="advInputItem4" itemValue="#{advInputItem4}" itemLabel="#{advInputItem4.description}"/>
					<f:ajax render="p_4"/>
				</p:selectOneMenu>
				<p:selectOneMenu styleClass="label-field-optional" widgetVar="st_4" id="s_4" value="#{userView.searchObject.searchFields[4].sortOrder}">
					<f:selectItems value="#{userView.sortOrderList}"/>
				</p:selectOneMenu>
				<p:datePicker id="fi_4" value="#{userView.searchObject.searchFields[4].dateCriterion}" pattern="#{userSession.dateTimeFormat}" size="20" showButtonBar="true" showIcon="true" showTime="true"/>
				<h:panelGroup id="p_4">
					<p:datePicker id="fb_4" value="#{userView.searchObject.searchFields[4].dateBetweenCriterion}" pattern="#{userSession.dateTimeFormat}" size="20" showButtonBar="true" showIcon="true" rendered="#{userView.searchObject.searchFields[4].between}" showTime="true"/>
				</h:panelGroup>

			</h:panelGrid>
			</p:scrollPanel>
			</p:tab>

			<p:tab title="#{i18n.search_input_adv}">
			<h:panelGrid columns="2">
				<h:outputLabel value="#{i18n.search_input_case}:" styleClass="label-field-mandatory"/>
				<p:selectBooleanCheckbox value="#{userView.searchObject.caseSensitive}"/>
				<h:outputLabel value="#{i18n.search_input_count}:" styleClass="label-field-mandatory"/>
				<p:selectBooleanCheckbox value="#{userView.searchObject.count}"/>
				<h:outputLabel value="#{i18n.search_input_filter_match}:" styleClass="label-field-mandatory"/>
				<p:selectBooleanCheckbox value="#{userView.searchObject.exactFilterMatch}"/>
				<h:outputLabel value="#{i18n.search_input_filter_fetch_size}:" styleClass="label-field-mandatory"/>
				<p:inputText value="#{userView.searchObject.maxResult}" size="5">
					<f:validateLongRange minimum="1" maximum="1000000"/>
				</p:inputText>
				<h:outputLabel value="#{i18n.search_input_visible_fields_label}:" styleClass="label-field-mandatory"/>
				<p:pickList styleClass="searchdialog-picklist" value="#{userView.visibleFields}" var="savedQueryListItem" itemLabel="#{savedQueryListItem.colLabel}" itemValue="#{savedQueryListItem}" converter="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.SearchFieldDTOConverter" addLabel="#{i18n.pick_list_add}" addAllLabel="#{i18n.pick_list_add_all}" removeLabel="#{i18n.pick_list_remove}" removeAllLabel="#{i18n.pick_list_remove_all}">
					<f:facet name="sourceCaption">#{i18n.search_input_all_fields}</f:facet>
					<f:facet name="targetCaption">#{i18n.search_input_visible_fields}</f:facet>
				</p:pickList>
			</h:panelGrid>
			</p:tab>

			<p:tab title="#{i18n.search_input_saved_query_title}">
				<h:panelGrid columns="1">
					<h:outputLabel styleClass="label-field-mandatory" value="#{i18n.search_input_lbl_saved_query}"/>
					<p:selectOneListbox id="savedQueryList" value="#{userView.selectedSavedQuery}" style="#{sizeServiceBean.searchQueriesHeight()}; width:480px">
						<f:selectItems value="#{userView.savedQueries}"/>
					</p:selectOneListbox>
					<h:panelGrid columns="2">
						<p:commandButton value="#{i18n.search_input_run_saved_query}" action="#{userView.runSavedQuery}" ajax="false"/>
						<p:commandButton value="#{i18n.search_input_delete_saved_query}" actionListener="#{userView.deleteSavedQuery}" update="savedQueryList" ajax="true"/>
					</h:panelGrid>
				</h:panelGrid>
			</p:tab>
		</p:tabView>

		<h:panelGrid columns="4">
			<p:commandButton id="cmdSearch" value="#{i18n.search_input_perform_search}" action="#{userView.fetchUsers}" ajax="false"/>
			<p:commandButton id="cmdReset" value="#{i18n.command_reset}" action="#{userView.resetSearchObject}" onclick="PF('dlgSearchInput').hide()" ajax="false"/>
			<p:commandButton id="cmdClear" value="#{i18n.command_clear}" action="#{userView.clearSearchObject}" update="tabViewSearchInput" ajax="true"/>
			<p:commandButton id="cmdCount" value="#{i18n.search_input_perform_count}" actionListener="#{userView.countRecords}" update="growl" ajax="true"/>
		</h:panelGrid>
	</p:dialog>

	<p:menubar>
		<p:submenu icon="pi pi-file" label="#{i18n.mnu_file}" id="panData_mniFile">
			<p:menuitem value="#{i18n.action_create}" ajax="true" id="panData_mniCreate" icon="pi pi-plus" rendered="#{userSession.checkAuthorizationString('ADMINISTRATOR')}" action="#{userView.openCreateNewUserDialog}">
				<f:setPropertyActionListener target="#{userSession.lastPage}" value="#{userView.currentPageURL}"/>
			</p:menuitem>
			<p:menuitem value="#{i18n.search_input_dlg_save_query}" icon="pi pi-save" onclick="PF('dlgSaveQuery').show()"/>
		</p:submenu>
		<p:submenu icon="pi pi-refresh" label="#{i18n.mnu_view}">
			<p:menuitem value="#{i18n.action_refresh}" ajax="false" icon="pi pi-refresh" actionListener="#{userView.fetchUsers}"/>
		</p:submenu>
		<p:submenu icon="pi pi-print" label="#{i18n.mnu_export}">
			<p:menuitem value="#{i18n.action_export_xls}" ajax="false" icon="pi pi-file-excel">
				<p:dataExporter type="xlsxstream" target="panData" fileName="UserList"/>
			</p:menuitem>
			<p:menuitem value="#{i18n.action_export_pdf}" ajax="false" icon="pi pi-file-pdf">
				<p:dataExporter type="pdf" target="panData" fileName="UserList"/>
			</p:menuitem>
		</p:submenu>
		<p:menuitem value="#{i18n.action_search_input}" ajax="true" icon="pi pi-search" id="panData_mniSearch" onclick="PF('dlgSearchInput').show()"/>
	</p:menubar>

	<br/>

	<p:dataTable id="panData" var="userViewItem" rows="#{userView.numberRows}"
		selectionTextDisabled="false" allowUnsorting="true" resizeMode="expand" multiViewState="true" 
		selectionMode="single" 
		selection="#{userView.selectedObject}"
		loadingMessage="#{i18n.action_fetch_data}"
		value="#{userView.usersList}" scrollable="false"
		paginatorPosition="top" paginatorAlwaysVisible="false" paginator="true" resizableColumns="true"
		rowKey="#{userViewItem.id}"
		paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
		rowsPerPageTemplate="50,150,400,1000">
		<p:ajax event="rowDblselect" listener="#{userView.onDoubleClick}"/>

		<p:column sortBy="#{userViewItem.name}" width="150" rendered="#{userView.searchObject.searchFields[0].visible}" >
			<f:facet name="header">
				<h:outputText value="#{i18n.lbl_attr_user_name}"/>
			</f:facet>
			<h:outputText value="#{userViewItem.name}">
			</h:outputText>
		</p:column>

		<p:column sortBy="#{userViewItem.email}" width="150" rendered="#{userView.searchObject.searchFields[1].visible}" >
			<f:facet name="header">
				<h:outputText value="#{i18n.lbl_attr_user_email}"/>
			</f:facet>
			<h:outputText value="#{userViewItem.email}">
			</h:outputText>
		</p:column>

		<p:column sortBy="#{userViewItem.active}" width="70" rendered="#{userView.searchObject.searchFields[2].visible}" >
			<f:facet name="header">
				<h:outputText value="#{i18n.lbl_attr_user_active}"/>
			</f:facet>
			<p:selectBooleanCheckbox value="#{userViewItem.active}" disabled="true"/>
		</p:column>

		<p:column sortBy="#{userViewItem.creationDate}" width="120" rendered="#{userView.searchObject.searchFields[3].visible}" >
			<f:facet name="header">
				<h:outputText value="#{i18n.lbl_attr_abstractentitywithid_creationdate}"/>
			</f:facet>
			<h:outputText value="#{userViewItem.creationDate}">
				<f:converter converterId="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.LocalDateTimeConverter"/>
				<f:attribute name="pattern" value="#{userSession.dateTimeFormat}"/>
				<f:attribute name="timeZone" value="#{userSession.timeZone}"/>
			</h:outputText>
		</p:column>

		<p:column sortBy="#{userViewItem.lastUpdate}" width="120" rendered="#{userView.searchObject.searchFields[4].visible}" >
			<f:facet name="header">
				<h:outputText value="#{i18n.lbl_attr_abstractentitywithid_lastupdate}"/>
			</f:facet>
			<h:outputText value="#{userViewItem.lastUpdate}">
				<f:converter converterId="net.sourceforge.jbizmo.commons.webclient.primefaces.converter.LocalDateTimeConverter"/>
				<f:attribute name="pattern" value="#{userSession.dateTimeFormat}"/>
				<f:attribute name="timeZone" value="#{userSession.timeZone}"/>
			</h:outputText>
		</p:column>
	</p:dataTable>
	<p/>

	<h:outputText styleClass="label-field-mandatory" value="#{i18n.result_total_number_records} #{userView.usersList.size()}"/>
	<h:outputText styleClass="label-field-mandatory" rendered="#{userView.searchObject.count}" value="&#160;#{i18n.search_input_count_of}&#160;"/>
	<h:outputText styleClass="label-field-mandatory" rendered="#{userView.searchObject.count}" value="#{userView.countResult}"/>



<!--Kontextmenü mit Möglichkeit, eine Zelle oder eine Zeile zu kopieren -->

	<h:inputHidden id="cellText" value="#{userView.cellText}" />
	<h:inputHidden id="rowCsv" value="#{userView.rowCsv}" />

	<p:contextMenu for="panData" beforeShow="updateContextData(event)" >
		<p:menuitem value="#{i18n.action_delete}" ajax="true" icon="pi pi-trash" id="panData_mniDelete" rendered="#{userSession.checkAuthorizationString('ADMINISTRATOR')}" onclick="PF('deleteConfirm').show()"/>
		<p:menuitem value="#{i18n.action_copy}" ajax="true" icon="pi pi-copy" id="panData_mniCopy" rendered="#{userSession.checkAuthorizationString('ADMINISTRATOR')}" onclick="PF('copyConfirm').show()"/>
		<p:menuitem value="#{i18n.action_create}" ajax="true" icon="pi pi-plus" rendered="#{userSession.checkAuthorizationString('ADMINISTRATOR')}" action="#{userView.openCreateNewUserDialog}">
			<f:setPropertyActionListener target="#{userSession.lastPage}" value="#{userView.currentPageURL}"/>
		</p:menuitem>
		<p:menuitem value="#{i18n.action_edit}" ajax="true" icon="pi pi-pencil" id="panData_mniUpdate" rendered="#{userSession.checkAuthorizationString('ADMINISTRATOR')}" action="#{userView.openEditUserDialog}">
			<f:setPropertyActionListener target="#{userSession.lastPage}" value="#{userView.currentPageURL}"/>
		</p:menuitem>
		<p:menuitem value="#{i18n.action_refresh}" ajax="false" type="push" icon="pi pi-refresh" id="panData_mniRefresh" actionListener="#{userView.fetchUsers}"/>
	</p:contextMenu>


	<p:confirmDialog modal="true" closeOnEscape="true" message="#{i18n.dialog_delete_question}" header="#{i18n.dialog_delete_title}" severity="warn" widgetVar="deleteConfirm">
		<p:commandButton value="#{i18n.command_yes}" oncomplete="PF('deleteConfirm').hide()" actionListener="#{userView.deleteUser}" id="panData_cmdYesDelete" ajax="false"/>
		<p:commandButton value="#{i18n.command_no}" onclick="PF('deleteConfirm').hide()" type="button"/>
	</p:confirmDialog>

	<p:confirmDialog modal="true" closeOnEscape="true" message="#{i18n.dialog_copy_question}" header="#{i18n.dialog_copy_title}" severity="info" widgetVar="copyConfirm">
		<p:commandButton value="#{i18n.command_yes}" oncomplete="PF('copyConfirm').hide()" action="#{userView.copy}" id="panData_cmdYesCopy" ajax="false"/>
		<p:commandButton value="#{i18n.command_no}" onclick="PF('copyConfirm').hide()" type="button"/>
	</p:confirmDialog>

	<p:dialog header="#{i18n.search_input_dlg_save_query}" widgetVar="dlgSaveQuery" id="dlgSaveQuery" modal="true" closeOnEscape="true" height="100">
		<h:panelGrid columns="3">
			<h:outputLabel value="#{i18n.search_input_lbl_save_query}" styleClass="label-field-mandatory"/>
			<p:inputText id="txtQueryName" value="#{userView.savedQueryName}">
			</p:inputText>
			<p:commandButton value="#{i18n.command_save}" id="saveQuery" action="#{userView.saveNewQuery}" ajax="false" onclick="PF('dlgSaveQuery').hide()"/>
			<p:defaultCommand target="saveQuery" scope="dlgSaveQuery"/>
		</h:panelGrid>
	</p:dialog>

	<p:defaultCommand target=":form:cmdSearch" scope="dlgSearchInput"/>

</ui:define>
</ui:composition>
